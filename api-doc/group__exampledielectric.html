<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MADNESS: Poisson&#39;s equation in a dielectric medium</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MADNESS
   &#160;<span id="projectnumber">0.10.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Poisson's equation in a dielectric medium</div>  </div>
</div><!--header-->
<div class="contents">
<p>The source is <a href="https://github.com/m-a-d-n-e-s-s/madness/blob/master/src/examples/dielectric.cc">here</a>.</p>
<dl class="section user"><dt>Points of interest</dt><dd><ul>
<li>use of iterative equation solver</li>
<li>convolution with the Green's function</li>
<li>unary operator to compute reciprocal of a function</li>
<li>use of diffuse domain approximation to represent interior surfaces</li>
<li>line and volume plots</li>
</ul>
</dd></dl>
<dl class="section user"><dt>Background</dt><dd></dd></dl>
<p>We wish to solve Poisson's equation within a non-homogeneous medium, i.e., in which the permittivity is not constant. </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \nabla . \left( \epsilon(r) \nabla u(r) \right) = - 4 \pi \rho(r) \]" src="form_159.png" width="141" height="14"/>
</p>
<p> Expanding and rearranging yields, </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \nabla^2 u(r) = - \frac{1}{\epsilon(r)} \left( 4 \pi \rho(r) + \nabla \epsilon(r) . \nabla u(r) \right) \]" src="form_160.png" width="219" height="30"/>
</p>
<p> We can interpret <img class="formulaInl" alt="$\rho / \epsilon$" src="form_161.png" width="19" height="14"/> as the effective free charge density and <img class="formulaInl" alt="$\nabla \epsilon . \nabla u / \epsilon$" src="form_118.png" width="48" height="14"/> as the induced surface charge density. Assuming free-space boundary conditions at long range we can invert the Laplacian by convolution with the free-space Green's function that is <img class="formulaInl" alt="$-1 / 4 \pi |r-s|$" src="form_125.png" width="69" height="14"/>. Note that MADNESS provides convolution with <img class="formulaInl" alt="$G(r,s) = 1/|r-s|$" src="form_126.png" width="98" height="14"/> so you have to keep track of the <img class="formulaInl" alt="$-1/4\pi$" src="form_127.png" width="36" height="14"/> yourself.</p>
<p>Thus, our equation becomes (deliberately written in the form of a fixed point iteration &mdash; given a guess for <img class="formulaInl" alt="$u$" src="form_76.png" width="9" height="6"/> we can compute the r.h.s. and directly obtain a new value for <img class="formulaInl" alt="$u$" src="form_76.png" width="9" height="6"/> that hopefully is closer to the solution) </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ u = G * \left(\rho_{\mbox{vol}} + \rho_{\mbox{surf}} \right) \]" src="form_162.png" width="123" height="16"/>
</p>
<p> where </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \rho_{\mbox{vol}} = \frac{\rho}{\epsilon} \]" src="form_163.png" width="48" height="24"/>
</p>
<p> and </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \rho_{\mbox{surf}} = \frac{\nabla \epsilon . \nabla u}{4 \pi \epsilon} \]" src="form_164.png" width="83" height="28"/>
</p>
<p>Let's solve a problem to which we know the exact answer &mdash; a point charge at the center of a sphere <img class="formulaInl" alt="$R=2$" src="form_165.png" width="33" height="10"/>. Inside the sphere the permittivity is <img class="formulaInl" alt="$\epsilon_1 = 1$" src="form_166.png" width="33" height="11"/> and outside it is <img class="formulaInl" alt="$\epsilon_2 = 10$" src="form_167.png" width="40" height="11"/>. The exact solution is </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ u(r) = \left \lbrace \begin{array}{cc} \frac{1}{\epsilon_2 |r|} &amp; |r| &gt; R \\ \frac{1}{\epsilon_1 |r|} + \left( \frac{1}{\epsilon_2} - \frac{1}{\epsilon_1} \right) \frac{1}{R} &amp; |r| &lt; R \end{array} \right . \]" src="form_168.png" width="213" height="41"/>
</p>
<p> The surface charge density integrated over the suface has the value </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ q_{\mbox{surface}} = -\frac{\epsilon_2 - \epsilon_1}{\epsilon_2} = -0.9 \]" src="form_169.png" width="153" height="25"/>
</p>
<p>To implement the problem in MADNESS we want the permittivity defined as a function over all space, so we define a characteristic function <img class="formulaInl" alt="$C(r)$" src="form_170.png" width="24" height="14"/> (or mask) that is defined to be one inside the sphere and zero outside </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ C(r) = H(R-|r|) \]" src="form_171.png" width="100" height="14"/>
</p>
<p> where <img class="formulaInl" alt="$H(x)$" src="form_172.png" width="28" height="14"/> is the Heaviside step function. Hence, we have </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \epsilon(r) = \epsilon_1 C(r) + \epsilon_2 \left( 1 - C(r) \right) \]" src="form_173.png" width="158" height="14"/>
</p>
<p> To smooth the discontinuity we replace the Heaviside step function with </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ H(x,\sigma) = \frac{1}{2} \left( 1 + \mathop{\mathrm{erf}} \frac{x}{\sigma} \right) \]" src="form_174.png" width="133" height="26"/>
</p>
<p> where <img class="formulaInl" alt="$\sigma$" src="form_175.png" width="8" height="6"/> is the effective width of the step (0.2 in the code). Similarly, the point charge is replaced by a suitably normalized <a class="el" href="classGaussian.html">Gaussian</a> with a an exponent sufficiently large as to appear as a point charge (delta function) on the scale of interest (we pick <img class="formulaInl" alt="$\xi=100$" src="form_176.png" width="43" height="13"/>) </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \rho(r) = \left(\pi \xi \right)^{-3/2} e^{-\xi |r|^2} \]" src="form_177.png" width="121" height="18"/>
</p>
<p>Starting from an initial guess we could try to iterate our equation for <img class="formulaInl" alt="$u(r)$" src="form_178.png" width="23" height="14"/> but, sadly, this does not converge reliably. The simplest approach is to introduce some damping or step restriction. With <img class="formulaInl" alt="$m$" src="form_179.png" width="13" height="6"/> indicating the iteration number, we write </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ u^{(m+1)} = \alpha u^{(m)} + (1-\alpha) G * \left(\rho^{(m)}_{\mbox{vol}} + \rho^{(m)}_{\mbox{surf}} \right) \]" src="form_180.png" width="243" height="24"/>
</p>
<p> with <img class="formulaInl" alt="$ \alpha \in [0,1]$" src="form_181.png" width="48" height="14"/> . This works (for sufficiently small <img class="formulaInl" alt="$\alpha$" src="form_182.png" width="8" height="6"/>) and is implemented in the code.</p>
<p><a class="el" href="classA.html">A</a> more robust approach is to use a solver that exploits information from previous iterations (the Krylov subspace) to estimate the optimal direction and length of the step to take. Such a solver is provided by nonlinsol.h. Each iteration we pass the current solution and corresponding residual to the solver and it provides the next trial vector.</p>
<p>In the code you can switch between using the solver or simple iteration by changing the value of <code>USE_SOLVER</code> .</p>
<p>One final point is how to compute the reciprocal of the permittivity. This operation is not provided explicity by MADNESS, in part because even functions that are analytically never zero, might be (nearly) zero due to numerical truncation. Handling this issue correctly is problem specific. More generally, we want to compute a function-of-a-function. If <img class="formulaInl" alt="$f(r)$" src="form_183.png" width="23" height="14"/> is a MADNESS function that takes a d-dimensional vector as its argument (in this examaple <img class="formulaInl" alt="$d=3$" src="form_184.png" width="29" height="10"/>) and <img class="formulaInl" alt="$F(x)$" src="form_185.png" width="25" height="14"/> is computable function that takes a scalar argument, we want to compute the new MADNESS function </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ g(r) = F(f(r)) \]" src="form_186.png" width="80" height="14"/>
</p>
<p> There are various ways to do this. The simplest is employed here &mdash; we define a function (<code><a class="el" href="dielectric_8cc.html#aa92759446c645b9f3114af44019cf750">reciprocal()</a></code> ) that is passed into the <code>unaryop()</code> method that modifies the function <em>in-place</em>. This simple approach is justified here since we know our input function is never zero even due to numerical noise, and the output function is about as smooth as the input. If it were not, we might have to refine the input function to obtain the desired precision. </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Apr 30 2024 15:11:17 for MADNESS by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
