<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MADNESS: Chemistry</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MADNESS
   &#160;<span id="projectnumber">0.10.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Chemistry<div class="ingroups"><a class="el" href="group__libraries.html">MADNESS libraries</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Chemistry:</div>
<div class="dyncontent">
<div class="center"><img src="group__chemistry.png" border="0" usemap="#agroup____chemistry" alt=""/></div>
<map name="agroup____chemistry" id="agroup____chemistry">
<area shape="rect" title=" " alt="" coords="197,5,287,31"/>
<area shape="rect" href="group__libraries.html" title=" " alt="" coords="5,5,149,31"/>
</map>
</div>
<dl class="section user"><dt>Background</dt><dd></dd></dl>
<p>MADNESS does quantum chemistry</p>
<dl class="section user"><dt>DFT functionals for the user</dt><dd></dd></dl>
<p><a class="el" href="classA.html">A</a> molecular wave function may be determined using the ground state density only. For all but the simplest local density approximation functionals we use the density functional library <a href="http://www.tddft.org/programs/octopus/wiki/index.php/Libxc">libxc</a>. The user may request a functional according to the general syntax </p><div class="fragment"><div class="line"><a class="code" href="newsolver__lda_8cc.html#a43e11219d21651c81d82ec5f629982ca">xc</a>  FUNC1 weight1 FUNC2 weight2 ..</div>
<div class="ttc" id="anewsolver__lda_8cc_html_a43e11219d21651c81d82ec5f629982ca"><div class="ttname"><a href="newsolver__lda_8cc.html#a43e11219d21651c81d82ec5f629982ca">xc</a></div><div class="ttdeci">XCfunctional xc</div><div class="ttdef"><b>Definition:</b> newsolver_lda.cc:53</div></div>
</div><!-- fragment --><p> where FUNC1 etc are the name of a libxc functional, and the weight describes the admixture coefficient</p>
<p>or use the following predefined functionals (not case sensitive) </p><div class="fragment"><div class="line"><a class="code" href="newsolver__lda_8cc.html#a43e11219d21651c81d82ec5f629982ca">xc</a> hf</div>
<div class="line"><a class="code" href="newsolver__lda_8cc.html#a43e11219d21651c81d82ec5f629982ca">xc</a> lda</div>
<div class="line"><a class="code" href="newsolver__lda_8cc.html#a43e11219d21651c81d82ec5f629982ca">xc</a> bp</div>
<div class="line"><a class="code" href="newsolver__lda_8cc.html#a43e11219d21651c81d82ec5f629982ca">xc</a> pbe</div>
<div class="line"><a class="code" href="newsolver__lda_8cc.html#a43e11219d21651c81d82ec5f629982ca">xc</a> pbe0</div>
<div class="line"><a class="code" href="newsolver__lda_8cc.html#a43e11219d21651c81d82ec5f629982ca">xc</a> b3lyp</div>
</div><!-- fragment --><p>As an example, the PBE0 functional would be expressed in the general syntax as </p><div class="fragment"><div class="line"><a class="code" href="newsolver__lda_8cc.html#a43e11219d21651c81d82ec5f629982ca">xc</a>  GGA_X_PBE 0.75 GGA_C_PBE 1.0 HF 0.25</div>
</div><!-- fragment --><p>Expert parameters are RHOTOL, RHOMIN, and GGATOL, which determine at which density value threshold (RHOTOL) the density will be set to RHOMIN inside libxc, and at which density the gga potential will be munged, since it might not be bound.</p>
<dl class="section user"><dt>DFT functionals for the developer</dt><dd></dd></dl>
<p><a class="el" href="classA.html">A</a> DFT functional is most easily constructed through the use of the <a class="el" href="classmadness_1_1XCOperator.html" title="operator class for the handling of DFT exchange-correlation functionals">madness::XCOperator</a> class in SCFOperators.h </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="SCFOperators_8h.html">SCFOperators.h</a>&quot;</span></div>
<div class="line">XCOperator xc_operator(world,&amp;calc,ispin);</div>
<div class="ttc" id="aSCFOperators_8h_html"><div class="ttname"><a href="SCFOperators_8h.html">SCFOperators.h</a></div><div class="ttdoc">Operators for the molecular HF and DFT code.</div></div>
</div><!-- fragment --><p>where the arguments to the constructor are the world and a pointer to a <a class="el" href="classmadness_1_1SCF.html">madness::SCF</a> or <a class="el" href="classmadness_1_1Nemo.html" title="The Nemo class.">madness::Nemo</a> calculation. The constructor will create the necessary density and density gradients (in XCOperator::prep_xc_args() ). Note that the ispin argument (0 for alpha, 1 for beta) is only important for the computation of the xc potential, and may be changed later on to avoid re-creation of the density (gradients). The functional information is passed to the constructor through the calculation parameters.</p>
<p><a class="el" href="classA.html">A</a> DFT energy and potential can be constructed as </p><div class="fragment"><div class="line"><span class="keywordtype">double</span> ex_energy=xc_operator.compute_xc_energy();</div>
<div class="line"><a class="code" href="namespacemadness.html#aabc223d277e0d9dd79d7c61d200d457f">real_function_3d</a> xc_potential=xc_operator.make_xc_potential();</div>
<div class="ttc" id="anamespacemadness_html_aabc223d277e0d9dd79d7c61d200d457f"><div class="ttname"><a href="namespacemadness.html#aabc223d277e0d9dd79d7c61d200d457f">madness::real_function_3d</a></div><div class="ttdeci">Function&lt; double, 3 &gt; real_function_3d</div><div class="ttdef"><b>Definition:</b> functypedefs.h:65</div></div>
</div><!-- fragment --><p>Direct application of the XC functional to a vector of orbitals mo may be accomplished as </p><div class="fragment"><div class="line">std::vector&lt;real_function_3d&gt; vmo = xc_operator(mo);</div>
</div><!-- fragment --><p>If a response kernel is requested (e.g. in CPHF equations, or in linear response), the kernel itself is numerically unstable. To some extent this instability is circumvented by performing as many operations as possible on a fixed grid, so that only the result of the kernel application is available </p><div class="fragment"><div class="line"><a class="code" href="namespacemadness.html#aabc223d277e0d9dd79d7c61d200d457f">real_function_3d</a> result=xc_operator.apply_xc_kernel(perturbed_density);</div>
</div><!-- fragment --><dl class="section user"><dt>Internal implementation details</dt><dd></dd></dl>
<p>For LDA functionals the density is processed as-is, only very small and negative densities are set to zero (through the RHOTOL and RHOMIN arguments).</p>
<p>For GGA functionals the reduced density gradients <img class="formulaInl" alt="$ \sigma$" src="form_49.png" width="8" height="6"/> are necessary, which decay very fast and cause numerical instabilites. To avoid these instabilities we express the density gradients as </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \rho = exp(\zeta) \\ \nabla \rho = \rho \nabla \zeta \\ \sigma = |\nabla\rho|^2 = |\nabla \zeta|^2 \rho^2 = \chi \rho^2 \]" src="form_52.png" width="263" height="16"/>
</p>
<p> which defines the quantities <img class="formulaInl" alt="$ \zeta$" src="form_53.png" width="6" height="13"/> and <img class="formulaInl" alt="$ \chi $" src="form_54.png" width="9" height="9"/>. The functional form of <img class="formulaInl" alt="$\zeta$" src="form_55.png" width="6" height="13"/> is a superposition of cones located at the nuclei with asymptotic slope of the HOMO orbital energy, its derivative is numerically more stable than that of the density itself. In this way the density gradients and the density may be munged in a consistent manner. In fact, often the ratio <img class="formulaInl" alt="$ \sigma/\rho^2 =\chi$" src="form_57.png" width="50" height="15"/> is used in DFT functionals. All functions are passed to libxc through the <a class="el" href="classmadness_1_1XCfunctional.html" title="Simplified interface to XC functionals.">madness::XCfunctional</a> interface class. <a class="el" href="classA.html">A</a> vector of functions named xc_arg is passed to the multiop method, with the various functions being on enumerated vector positions, described in <a class="el" href="classmadness_1_1XCfunctional.html#a41609549f1de62ee9474b202700def62">madness::XCfunctional::xc_arg</a>.</p>
<p>Response kernels for GGA are even more numerically unstable than the XC potential. We use the same log-derivative trick as before, which fixes the long-range noise. However the intermediate potentials have to be multiplied with the gradients of the (perturbed) density, followed by taking the divergence, which is equivalent to applying the Laplacian to the (perturbed) density. Numerical noise is amplified and convergence during the SCF or CPHF iterations might not be achieved. Furthermore, the perturbed density is not strictly positive, so its logarithm is not defined. We can pull an unperturbed density out of the perturbed density gradient to regain some stability </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \sigma_\mathrm{pt}=\nabla\rho\cdot\nabla\rho_\mathrm{pt} = \rho\left(\nabla\zeta\cdot\nabla\rho_\mathrm{pt}\right) \]" src="form_65.png" width="174" height="14"/>
</p>
<p>The code in XCOperator works as follows</p><ul>
<li>compute <img class="formulaInl" alt="$\zeta$" src="form_55.png" width="6" height="13"/>, density gradients, etc through <a class="el" href="classmadness_1_1XCOperator.html#ada974c2dccf43d4b4ab110da3b55d0d6" title="compute the intermediates for the XC functionals">madness::XCOperator::prep_xc_args</a> and put them on a vector of functions. So far these are spin densities.</li>
<li>call xc_potential or xc_kernel_apply<ul>
<li>call <code><a class="el" href="classmadness_1_1XCfunctional.html#ab9019fd993db3ff286f3bfe1f27dd6e3" title="convert the raw density (gradient) data to be used by the xc operators">madness::XCfunctional::make_libxc_args</a></code> to munge the density and density gradients &ndash; convert spin density to full density if spin-restricted</li>
<li>call libxc functions to compute the functional derivatives of the density functional</li>
<li>multiply intermediate quantities to the functional derivatives</li>
<li>return scalar intermediates, for the exact description see in <a class="el" href="classmadness_1_1XCfunctional.html#a24f51ee14bd497410154a1c52fb4cc50" title="Computes components of the potential (derivative of the energy functional) at np points.">madness::XCfunctional::vxc</a> and <a class="el" href="classmadness_1_1XCfunctional.html#a60c9e78fc38c5a3fbc963724d7e69a22" title="compute the second derivative of the XC energy wrt the density and apply">madness::XCfunctional::fxc_apply</a></li>
</ul>
</li>
<li>multiply the semilocal intermediates with the density gradients, take div operator </li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Apr 30 2024 15:11:17 for MADNESS by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
